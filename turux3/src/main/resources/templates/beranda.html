<!-- beranda.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="Turu.ico" type="image/x-icon" />
  <!-- Logo/Icon Web -->
  <title>ü§§- Beranda</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <!-- Library CSS Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />
  <!-- Icon Asset -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- Style Utama -->
</head>

<body>
  <!-- Fixed Header -->
  <div class="row">
    <div class="column main">
      <div class="canvas-mobile beranda">
        <!-- Header Status -->
        <header class="header">
          <div class="date" id="currentDate">[Tanggal]</div>
          <div class="time" id="currentTime">[WIB]</div>
        </header>
        <!-- CONTENT PAGE -->
        <div class="content beranda center">
          <div class="center" th:if="${state}">
            <button id="stopwatchBtn" class="turu-button">üò¥</button>
            <br>
            <h4 id="labelBtn" th:text="${buttonLabel}">Tombol Bangun</h4>
          </div>
          <div class="center" th:unless="${state}">
            <button id="stopwatchBtn" class="turu-button">üôÇ</button>
            <br>
            <h4 id="labelBtn" th:text="${buttonLabel}">Tombol Tidur</h4>
          </div>
          <div id="stateContainer" th:data-state="${state}"></div>


          <!-- Button Tips -->
          <a href="/tips" class="btn btn-outline-light btn-sm tips-button">
            <i class="bi bi-moon-stars-fill"></i>
            &nbsp;Tips Tidur
          </a>

          <div class="subtitle">
            Data Tidur <button class="btn-pencil" data-bs-toggle="modal" data-bs-target="#editModal"
              id="editData">&#9998; </button>


          </div>
          <div class="result" id="timestampDisplay">Mulai: 17:49:28 - Selesai: 17:49:29</div>
          <div class="result" id="durationDisplay">13 j 20m</div>


          <br><br><br><br>
          <div class="subtitle">Skor Tidur</div>
          <!-- Character Display -->
          <div class="row">
            <div class="col result" id="mascotDisplay">üê®</div>
            <div class="col result" id="scoreDisplay">69</div>
          </div>
          <h3 class="result" id="mascotNameDisplay">Koala Pemalas</h3>
          <div class="result" id="mascotDescriptionDisplay">Anda telah tidur lebih dari 12 jam, tidur Anda melebihi
            batas
            normal.
          </div>

          <br><br><br><br>
          <div class="subtitle">Statistik Tidur</div>
            <div class="result" id="rangeWeek" th:text="${dateRange}">16 Desember 2024 - 22 Desember 2024</div>

          <!-- Tambahkan Chart Tidur Mingguan -->
          <div style="width: 100%; max-width: 600px; margin: 0 auto;">
            <canvas id="sleepChart"></canvas>
          </div>

          <!-- Kotak Area Statistik Lama (Jangan Diubah) -->
          <div class="kotakAreaStatistik">.</div>
        </div>

        <!-- Floating Button -->
        <button class="floating-btn" data-bs-toggle="modal" data-bs-target="#tambahModal">
          <i class="bi bi-calendar-plus"></i> Tambah
        </button>

        <!-- Modal Input Data Tidur -->
        <div class="modal fade" id="tambahModal" tabindex="-1" aria-labelledby="tambahModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="tambahModalLabel">Tambah Data Tidur</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="dataTidurForm" method="POST" action="tambahTidur">
                  <div class="mb-3">
                    <label for="waktuMulai" class="form-label">Waktu Mulai Tidur</label>
                    <input type="datetime-local" class="form-control" id="waktuMulai" required>
                  </div>
                  <div class="mb-3">
                    <label for="waktuSelesai" class="form-label">Waktu Bangun</label>
                    <input type="datetime-local" class="form-control" id="waktuSelesai" required>
                  </div>
                  <br><br>
                  <button class="btn btn-cancel me-3" data-bs-dismiss="modal">Kembali</button>
                  <button type="submit" class="btn btn-confirm">Simpan</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Edit Data Tidur -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Data Tidur</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="dataTidurForm" method="POST" action="editTidur">
                  <div class="mb-3">
                    <label for="waktuMulai" class="form-label">Waktu Mulai Tidur</label>
                    <input type="datetime-local" class="form-control" id="waktuMulai" value="xxx" required>
                  </div>
                  <div class="mb-3">
                    <label for="waktuSelesai" class="form-label">Waktu Bangun</label>
                    <input type="datetime-local" class="form-control" id="waktuSelesai" value="xxx" required>
                  </div>
                  <br><br>
                  <button class="btn btn-cancel me-3" data-bs-dismiss="modal">Kembali</button>
                  <button type="submit" class="btn btn-confirm">Simpan</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Sticky Bottom Navbar -->
        <nav class="navbar navbar-expand navbar-dark">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" th:href="@{/beranda}">
                <span class="bi bi-grid-fill nav-icon"></span>
                Beranda
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/radio}">
                <i class="bi bi-music-note nav-icon"></i>
                Radio
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/akun}">
                <i class="bi bi-person-fill nav-icon"></i>
                Akun
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="column creators middle">
      <br><br><br>
      <h2><b>Turu</b>- <i>Aplikasi Monitoring Tidur</i></h2>
      <br>
      <samp>Creators:</samp>
      <div class="creator">
        <p th:each="creator : ${creators}">
          <span th:text="${creator.icon}">Icon</span>
          <a th:href="${creator.link}" th:text="${creator.name}" target="_blank">Name</a>
        </p>
      </div>
    </div>
    <div class="column qr middle center">
      <br><br><br>
      <img src="../asset/QR_Github_Turu.png">
      <br><br><br>
      <h5>Scan to <a href="https://github.com/TURU-template/TURU-COLLABORATION/" target="_blank"
          style="text-decoration: underline;">Get Turu!</a> üò¥</h5>
    </div>
  </div>
  <script src="js/scriptHeader.js"></script>
  <script src="js/scriptBeranda.js"></script>
  <script src="js/scriptRadio.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script th:inline="javascript">
      // Mendapatkan data dari controller
      var sleepScores = /*[[${sleepScores}]]*/;  // Pastikan data yang dikirim ada
      var dayLabels = /*[[${dayLabels}]]*/;      // Pastikan data yang dikirim ada

      console.log('Sleep Scores:', sleepScores); // Debugging untuk memastikan data dikirim
      console.log('Day Labels:', dayLabels);     // Debugging untuk memastikan data dikirim

      var ctx = document.getElementById('sleepChart').getContext('2d');
      var sleepChart = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: dayLabels,
              datasets: [{
                  label: 'Sleep Scores',
                  data: sleepScores,
                  backgroundColor: 'rgba(75, 192, 192, 0.2)',
                  borderColor: 'rgba(75, 192, 192, 1)',
                  borderWidth: 1
              }]
          },
          options: {
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
  </script>

  <script>
    // document.addEventListener("DOMContentLoaded", function () {
    //   const form = document.getElementById("dataTidurForm");

    //   form.addEventListener("submit", async (event) => {
    //     event.preventDefault();

    //     // Ambil input dari form
    //     const tanggalMulai = document.getElementById("tanggalMulai").value;
    //     const waktuMulai = document.getElementById("waktuMulai").value;
    //     const tanggalSelesai = document.getElementById("tanggalSelesai").value;
    //     const waktuSelesai = document.getElementById("waktuSelesai").value;

    //     // Gabungkan tanggal dan waktu menjadi format ISO
    //     const waktuMulaiDateTime = `${tanggalMulai}T${waktuMulai}:00`;
    //     const waktuSelesaiDateTime = `${tanggalSelesai}T${waktuSelesai}:00`;

    //     // Ambil pengguna yang sedang login
    //     const response = await fetch("/akun", { method: "GET" });
    //     const pengguna = await response.json();

    //     if (!pengguna || !pengguna.id) {
    //       alert("Pengguna tidak ditemukan!");
    //       return;
    //     }

    //     // Kirim data ke server
    //     const responseTambah = await fetch("/data-tidur/tambah", {
    //       method: "POST",
    //       headers: {
    //         "Content-Type": "application/json",
    //       },
    //       body: JSON.stringify({
    //         waktuMulai: waktuMulaiDateTime,
    //         waktuSelesai: waktuSelesaiDateTime,
    //         idPengguna: pengguna.id,
    //       }),
    //     });

    //     if (responseTambah.ok) {
    //       alert("Data tidur berhasil ditambahkan!");
    //       location.reload(); // Reload halaman setelah berhasil
    //     } else {
    //       alert("Terjadi kesalahan saat menambahkan data!");
    //     }
    //   });
    // });
  </script>
</body>

</html>